{% extends "base.html" %}
{% load static %}
{% load browse_filters %}
{% load mptt_tags %}
{% load static mptt_tags %}

{% block set_filter_by_page %}
$("#id_hist_type_label").hide();
$("#id_hist_type_drop_down_button").hide();
{% endblock %}

{% block includes %}
<link rel="stylesheet" type="text/css" href="{% static 'browse/css/unitip.css' %}" />
<link rel="stylesheet" type="text/css" href="{% static 'browse/css/msa0.4.6.css' %}" />
<script type="text/javascript" src="{% static 'browse/js/unitip.js' %}"></script>
<script type="text/javascript" src="{% static 'browse/js/raphael-min.js' %}"></script>
<script type="text/javascript" src="{% static 'browse/js/jsphylosvg-min.js' %}"></script>
<script src="{% static 'browse/js/xhr@latest.js' %}"></script>
<script src="{% static 'browse/js/msa@0.4.6.js' %}"></script>
<script src="{% static 'browse/js/biojs-io-fasta.js' %}"></script>
<script src="{% static 'browse/js/biojs-io-gff.js' %}"></script>
<script src="{% static 'browse/js/msa.js' %}"></script>
<script type="module">
import {Runtime, Inspector} from "{% static 'browse/js/runtime.js' %}";
import define from "{% static 'browse/js/05775bc344fcf638@146.js' %}";
var variants_list = {{ variants_list|safe }};
var tree_url = "{% static tree_url %}";
new Runtime().module(define, name => {
  if (name === "chart") return new Inspector(document.querySelector("#tree"));
  if (name === "viewof showLength") return new Inspector(document.querySelector("#showLength"));
  return ["update"].includes(name);
}, {{ variants_list|safe }}, "{% static tree_url %}");
$(document).ready(function(){
$('#mytabs a[href="#variant"]').tab('show')
});
</script>

<script type="text/javascript">
function variant_click(varid){
    console.log(varid)
    let element = document.getElementById("childrenul-"+varid);
    let button = document.getElementById("childrenbutton-"+varid);
    console.log(button.innerText)
    let hidden = element.getAttribute("hidden");
    console.log("clicked")
    if (hidden) {
        console.log("hidden")
       element.removeAttribute("hidden");
        button.innerText = "Hide variant groups for " + varid;
        {#button.innerText = "-";#}
    } else {
        console.log("unhidden")
       element.setAttribute("hidden", "hidden");
        button.innerText = "Show variant groups for " + varid;
        {#button.innerText = "+";#}
    }
  }
</script>
{% endblock %}

{% block content %}
<div class="container" style="margin-top:30px;">
  <div class="row">
    <div class="col-xs-2"></div>
    <div class="col-xs-2">
      <img src="{% with 'browse/img/'|add:histone_type|add:"_cropped"|add:'.png' as image_static %}{% static image_static %}{% endwith %}" width="75%" />
    </div>
    <div class="col-xs-8">
      <div class="row">
        <div class="col-xs-12">
          <h1>
            <a href="{% url 'browse:browse_types' %}"><span class="glyphicon glyphicon-home" /> </a> /
            Histone type: {{ histone_type }}
          </h1>
        </div>

      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <div class="container">
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist" id="mytabs">
          <li role="presentation"><a href="#variant" aria-controls="variant" role="tab" data-toggle="tab">Summary</a></li>
          <li role="presentation"><a href="#curated" aria-controls="curated" role="tab" data-toggle="tab">Curated Sequences</a></li>
          <li role="presentation"><a href="#seed" aria-controls="seed" role="tab" data-toggle="tab">Curated Alignments</a></li>
          <li role="presentation"><a href="#sequences" aria-controls="sequences" role="tab" data-toggle="tab">Automatically Extracted Sequences</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
          <div role="tabpanel" class="tab-pane" id="variant">
            <div class="row">
            </div>
            <div class="row">
              <div class="col-xs-12">
                <div class="row center-block">

                    <h4 class="page-header">Description</h4>

                    {{ histone_description.summary }} <br >
                    {% if alternate_names %}
                    <b>Alternate names:</b> {{ alternate_names }}
                    {% endif %}



                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-xs-3">
                <div class="row center-block">
                  <div class="col-xs-12">
                    <h4 class="page-header">Histone Variants</h4>
                    <div class="list-group" style="height:100%;">
                        <ul id="variant_ul" class="nav nav-list-main">
                            {% recursetree variants_info %}

                                <li>
{#                                    <img id="childrenbutton-{{ node.id }}" class="list-group-item left-side" onclick="variant_click('{{ node.id }}');" src="{% with 'browse/img/plus.png' as image_static %}{% static image_static %}{% endwith %}" width="2% "/>#}
                                    <a class="list-group-item right-side" href="{% url 'browse:browse_variant' histone_type node.id %}">
                                        <span class="badge variant-count-badge" style="background-color:{{ node.color }};" title="# of sequences in curated set: {{ node.num_curated }}
# of sequences in total set: {{ node.num_sequences }}">{{ node.num_curated }} / {{ node.num_sequences }}</span>
                                        <b>{{ node.id|undspace }}</b> <br />
                                        <small>Alternate names: {% if node.alternate_names or node.alternate_names != "" %}{{ node.alternate_names }}{% else %}<i>None</i>{% endif %}</small><br />
                                        <small>Taxonomic span: {{ node.taxonomic_span }}</small>

                                    </a>

                                    {% if not node.is_leaf_node %}
                                        <ul id="childrenul-{{ node.id }}" class="children nav nav-list-main" hidden="hidden" style="padding-left: 10px">
                                            {{ children }}
                                        </ul>
                                        <button id="childrenbutton-{{ node.id }}" class="list-group-item" onclick="variant_click('{{ node.id }}');">Show variant groups for {{node.id}}</button>
                                    {% endif %}
                                </li>
                            {% endrecursetree %}
                        </ul>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-xs-9">
                <h4 class="page-header">Phylogenetic tree of variants (curated sequences)</h4>
                <div id="showLength"></div>
                <div id="tree"></div>
                Above, alignments of curated sequences from all {{ histone_type }} variants have been combined to construct the phylogenetic tree. Most of the variants cluster in separate clades. Click on the taxa name to learn more about its variant.
              </div>
            </div>
          </div>
          <div role="tabpanel" class="tab-pane" id="curated">
            {% include "sequences.html" with page_name="browse_curated_variants_"|add:histone_type|rchar:"." quick_msa=True curated=True %}
          </div>
          <div role="tabpanel" class="tab-pane" id="sequences">
            {% include "sequences.html" with page_name="browse_variants_"|add:histone_type|rchar:"." %}
          </div>
          <div role="tabpanel" class="tab-pane" id="seed">
            <div>
{#                <div class="col-sm-1">#}
{#                    <p>View:</p>#}
{#                </div>#}
{#                <div class="col-sm-11">#}
                <div class="btn-group">
                    <label class="radio-inline"><input type="radio" name="optradio" checked>Multiple Sequence Alignment</label>
                    <label class="radio-inline"><input type="radio" name="optradio">Classification tree</label>
                </div>
{#                <div class="btn-group">#}
{#                  <label class="btn btn-secondary" for="option1"><input type="radio" class="btn-check" name="options" id="option1" autocomplete="off" checked />Checked</label>#}
{#                  <label class="btn btn-secondary" for="option2"><input type="radio" class="btn-check" name="options" id="option2" autocomplete="off" />Radio</label>#}
{#                </div>#}
                {% include "seed.html" with msa_id="browse" msa_url=seed_url|add:"?limit=500&consensus=limit" download_url=seed_url|add:"?download=true" %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


{% endblock %}


